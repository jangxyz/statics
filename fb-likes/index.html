<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <script src="base.js"></script>
    <link rel="stylesheet" type="text/css" href="fb-likes.css" />

    <script src="lodash.min.js"></script>
    <script src="underscore.string.min.js"></script>
    <script src="coffee-script.js"></script>
    <script src="jquery-1.10.2.min.js"></script>
    <script src="moment.min.js"></script>

    <script type="text/javascript" src="http://neomparam.github.io/feeduck/feeduck.jquery.js"></script>
    <link rel="stylesheet" href="http://neomparam.github.io/feeduck/feeduck.css" type="text/css" />

    <script src="status-log.js"></script>
    <link rel="stylesheet" type="text/css" href="status-log.css" />

</head>
<body>
<div id="fb-root"></div>

<h1>Welcome</h1>
<p>
    주의: 당신의 데이터는 아무렇게나 쓰일 수 있습니다.
</p>

<div class='checking-login-status'>
    로그인 확인 중...
</div>

<ul class="actions">
    <li class='login auth-action'>
        페이스북에 <a href="" class='login'>로그인</a>하세여
    </li>
    <li class='logout auth-action'>
        페이스북에서 <a href="#" onclick="logoutFacebook();return false;">로그아웃</a>
    </li>
</ul>

<h3 class="actions">나</h3>
<ul class="actions">
    <li id="my-posts" class='fb-action'> 
        <a href="my_posts.html">내 최근 포스팅 보기</a>
    </li>
    <li id="my-likes-post" class='fb-action'> 
        <a href="my_likes_post.html">내가 like한 포스팅들 보기</a>
    </li>
    <li id="my-likes-friends" class='fb-action'> 
        <a href="my_likes_friends.html">내가 like한 친구들 보기</a>
    </li>
    <li id="my-likes-friends-relative" class='fb-action'> 
        <a href="my_likes_friends_relative.html">내가 like한 친구들 보기 (상대적)</a>
    </li>
</ul>

<h3 class="actions">친구들</h3>
<ul class="actions">
    <!--
    <li id="get-friends-posts"> 
        <a href="#">친구들의 포스팅 보기</a>
    </li>
    -->
    <li id="my-likers-count" class='fb-action'> 
        <a href="my_likers_count.html">최근 내 포스팅 like한 친구들 보기</a>
    </li>
    <li id="my-likers-status-only-count" class='fb-action'> 
        <a href="my_likers_status_only_count.html">최근 내 상태 like한 친구들 보기</a>
    </li>
</ul>

<script type="text/coffeescript">

    #
    # Get Friends Posts
    #
    $el = $("#get-friends-posts")
    $el.find('a').on "click", (e) ->
        e.preventDefault();

        query = 
          query1: "SELECT uid2 FROM friend WHERE uid1 = me()"
          query2: """
                    SELECT type, post_id, actor_id, source_id, via_id, target_id, message, attribution, created_time, like_info.like_count, action_links 
                    FROM stream WHERE source_id in (
                        SELECT uid2 FROM #query1
                    )
                  """

        runQuery query, (response) -> 
            _status.log("query fetched");
            #$el.append("<div class='response'>#{JSON.stringify response}</div>")

        $el.append("<pre class='fql'>#{JSON.stringify query}</pre>")

    # 
        #query = '''
        #    SELECT name FROM user WHERE uid in (
        #        SELECT post_id, user_id FROM like WHERE post_id in (
        #                SELECT post_id FROM stream WHERE source_id = me() AND actor_id = me()
        #            )
        #    )
        #'''

</script>


<script>
    function startApp() {
        $('.checking-login-status').hide();
        $('.actions li.login').hide();
        //
        $('h3.actions').show();
        $('.actions li.fb-action').show();
    }
</script>

<ul id="status" style="display: none;"></ul>
</body>
</html>
